<div class="comment-panel card footer compact">
  <h3>ğŸ’¬ ç¾¤çµ„ç•™è¨€æ¿</h3>

  <div id="commentsList" class="comments" aria-live="polite">
    {% if comments_stream_url %}
      {# åˆæ¬¡è¼‰å…¥ç”± JS å–å› #}
    {% endif %}
  </div>

 <form action="{{ comment_post_url }}" method="post" class="form composer">
  <div class="inline-row">
    <label for="nickname">æˆ‘çš„æš±ç¨±ï¼ˆæ­¤ç¾¤çµ„ï¼‰</label>
    <input id="nickname" type="text" name="nickname" value="{{ saved_nick or '' }}" maxlength="10"
           placeholder="">
  </div>

  <label for="message">ç•™è¨€å…§å®¹</label>
  <input id="message" type="text" name="message" maxlength="30" required placeholder="èªªé»ä»€éº¼...">
  <button type="submit">é€å‡ºç•™è¨€</button>
 </form>



  {% if comments_stream_url %}
  <script>
    async function loadComments(scrollToBottom=true) {
      try {
        const res = await fetch("{{ comments_stream_url }}", { cache: "no-store" });
        const html = await res.text();
        const box = document.getElementById("commentsList");
        if (box) {
          const atBottom = Math.abs(box.scrollHeight - box.clientHeight - box.scrollTop) < 4;
          box.innerHTML = html;
          // è‹¥æ˜¯ç¬¬ä¸€æ¬¡è¼‰å…¥æˆ–åŸæœ¬å°±å·²ç¶“åœ¨åº•éƒ¨ï¼Œè¼‰å…¥å¾Œæ²åˆ°æœ€åº•
          if (scrollToBottom || atBottom) {
            box.scrollTop = box.scrollHeight;
          }
        }
      } catch (e) {}
    }
    loadComments(true);
    setInterval(() => loadComments(false), 5000);
  </script>
  {% endif %}
</div>
